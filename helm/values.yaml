# Default values for nodereaper
# This is a YAML-formatted file.

# Image configuration
image:
  repository: ghcr.io/sdaberdaku/nodereaper
  pullPolicy: IfNotPresent
  tag: ""

# Image pull secrets for private registries
imagePullSecrets: [ ]
# - name: myregistrykey

# NodeReaper configuration
config:
  # Minimum age before a node can be deleted (e.g., 10m, 1h, 30s)
  nodeMinAge: "30m"

  # Taints that indicate a node is probably unhealthy (list) and should be considered for deletion.
  unhealthyTaints:
    - node.kubernetes.io/network-unavailable
    - node.kubernetes.io/not-ready
    - node.kubernetes.io/unreachable
    - node.kubernetes.io/unschedulable

  # Annotations that provide permanent protection from deletion (list of key=value pairs)
  # Nodes with these exact annotation key-value pairs will never be deleted by NodeReaper
  protectionAnnotations:
    - karpenter.sh/do-not-evict=true
    - cluster-autoscaler.kubernetes.io/scale-down-disabled=true
    - nodereaper.io/do-not-delete=true

  # Labels that provide permanent protection from deletion (list of key=value pairs)
  # Nodes with these exact label key-value pairs will never be deleted by NodeReaper
  protectionLabels: [ ]

  # Enable finalizer cleanup for stuck nodes
  enableFinalizerCleanup: true

  # Timeout before taking over nodes marked for deletion (e.g., 15m, 30m, 1h)
  # Nodes marked for deletion will be protected for this duration, after which
  # NodeReaper will take over and delete them if they meet deletion criteria
  deletionTimeout: "15m"

  # Finalizers that are safe to remove when nodes are stuck terminating (list)
  # Only finalizers with these exact names will be removed during cleanup
  # Default includes common safe finalizers that are typically safe to remove
  removableFinalizers:
    - karpenter.sh/termination
    - node.kubernetes.io/exclude-from-external-load-balancers

  # Enable dry-run mode (only log actions, don't actually delete nodes)
  dryRun: false

  # Logging level (DEBUG, INFO, WARNING, ERROR)
  logLevel: "INFO"

  # Use "json" for structured logging in production environments
  enableJsonLogs: true

  # Cluster name for notifications (defaults to "unknown" if not set)
  clusterName: ""

  # Node label selector to filter which nodes to consider for deletion
  # Format: map of key-value pairs
  # Examples:
  #   cleanup-enabled: "true"
  #   instance-type: "m5.large"
  #   zone: "us-west-2a"
  nodeLabelSelector: { }

# CronJob configuration
cronjob:
  # Schedule in cron format (default: every 10 minutes)
  schedule: "*/10 * * * *"

  # Number of successful finished jobs to retain
  successfulJobsHistoryLimit: 3

  # Number of failed finished jobs to retain
  failedJobsHistoryLimit: 1

  # Deadline in seconds for starting the job if it misses scheduled time
  startingDeadlineSeconds: 300

  # Concurrency policy (Allow, Forbid, Replace)
  concurrencyPolicy: Forbid

  # Restart policy for the job pods
  restartPolicy: OnFailure

# Slack notifications
slack:
  # Enable Slack notifications
  enabled: false

  # Slack webhook URL (can be set via existing secret)
  webhookUrl: ""

  # Use existing secret for webhook URL
  existingSecret:
    name: ""
    key: "slack-webhook-url"

# Service account configuration
serviceAccount:
  # Specifies whether a service account should be created
  create: true

  # Annotations to add to the service account
  annotations: { }

  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# RBAC configuration
rbac:
  # Specifies whether RBAC resources should be created
  create: true

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65534
  runAsGroup: 65534
  fsGroup: 65534

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 65534

# Resource limits and requests
resources:
  limits:
    memory: 128Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Node selector for pod assignment
nodeSelector: { }

# Tolerations for pod assignment
tolerations: [ ]

# Affinity for pod assignment
affinity: { }

# Pod annotations
podAnnotations: { }

# Pod labels
podLabels: { }
